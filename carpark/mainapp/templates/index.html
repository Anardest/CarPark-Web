{% extends 'base.html' %}

{% block title %}
    Главная страница
{% endblock %}

{% block content %}
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<!-- Карточки -->
<div class="container-fluid mt-6" style="margin-top: 2rem;">
  <h1 class="text-center nav-item">Краткие сведения</h1>
  <div class="row">
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Автомобили</h5>
                <p class="card-text">{{ total_cars }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Водители</h5>
                <p class="card-text">{{ total_drivers }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Всего поездок</h5>
                <p class="card-text">{{ total_trips }}</p>
            </div>
        </div>
    </div>
    <div class="col-md-3">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">Средний пробег</h5>
                <p class="card-text">{{ average_mileage|floatformat:2 }} км</p>
            </div>
        </div>
    </div>
  </div>
</div>
<ul>
</ul>
<!-- Краткие логи -->
<div class="container-fluid p-lg-2 mt-6" style="margin-top: 2rem;">
  <h1 class="text-center nav-item">Последние Действия</h1>
  <table class="table">
    <thead>
        <tr>
            <th>Дата</th>
            <th>Действие</th>
            <th>Детали</th>
        </tr>
    </thead>
    <tbody>
        <tr>
            <td>2023-10-01</td>
            <td>Добавлен автомобиль</td>
            <td>Toyota Camry, 2020</td>
        </tr>
        <tr>
            <td>2023-10-02</td>
            <td>Создана поездка</td>
            <td>Водитель: Иван Иванов, Маршрут: Москва - Санкт-Петербург</td>
        </tr>
        <tr>
          <td>2023-10-01</td>
          <td>Добавлен автомобиль</td>
          <td>Toyota Camry, 2020</td>
        </tr>
        <tr>
          <td>2023-10-01</td>
          <td>Добавлен автомобиль</td>
          <td>Toyota Camry, 2020</td>
        </tr>
    </tbody>
  </table>
</div>
<!-- Уведомления -->

<div class="container-fluid" style="margin-top: 2rem;">
  <h1 class="text-center nav-item">Уведомления</h1>
  <div class="alert alert-warning" role="alert">
    <i class="fas fa-exclamation-triangle"></i> 3 автомобиля требуют техобслуживания.
  </div>
  <div class="alert alert-warning" role="alert">
    <i class="fas fa-exclamation-triangle"></i> 3 автомобиля требуют техобслуживания.
  </div>
</div>

    <div class="container-fluid p-lg-2 mt-6" style="margin-top: 2rem;">
        <div class="card">
            <div class="card-body">

                <h1 class="text-center nav-item">Управление автопарком</h1>
            
                <!-- Кнопки для отображения данных -->
                <button id="show-cars" class="btn btn-primary">Показать автомобили</button>
                <button id="show-drivers" class="btn btn-primary">Показать водителей</button>
                <button id="show-trips" class="btn btn-primary">Показать поездки</button>
            
                <!-- Таблица для автомобилей -->
                <table class="table" id="cars-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Марка</th>
                            <th>Модель</th>
                            <th>Год</th>
                            <th>Пробег</th>
                            <th>Подробно</th>
                        </tr>
                    </thead>
                    <tbody id="cars-table-body">
                        <!-- Сюда будут вставляться строки с данными -->
                    </tbody>
                </table>
            
                <!-- Таблица для водителей -->
                <table class="table" id="drivers-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Фамилия</th>
                            <th>Имя</th>
                            <th>Дата рождения</th>
                            <th>Подробно</th>
                        </tr>
                    </thead>
                    <tbody id="drivers-table-body">
                        <!-- Сюда будут вставляться строки с данными -->
                    </tbody>
                </table>
            
                <!-- Таблица для поездок -->
                <table class="table" id="trips-table" style="display: none;">
                    <thead>
                        <tr>
                            <th>Начало</th>
                            <th>Конец</th>
                            <th>Водитель</th>
                            <th>Автомобиль</th>
                            <th>Начало</th>
                            <th>Конец</th>
                            <th>Подробно</th>
                        </tr>
                    </thead>
                    <tbody id="trips-table-body">
                        <!-- Сюда будут вставляться строки с данными -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <script>
        $(document).ready(function() {
            // Обработчик для кнопки "Показать автомобили"
            $('#show-cars').click(function() {
                $.get('/get_cars/', function(data) {
                    // Показываем таблицу автомобилей и скрываем остальные
                    $('#cars-table').show();
                    $('#drivers-table').hide();
                    $('#trips-table').hide();
    
                    // Очищаем содержимое tbody
                    $('#cars-table-body').empty();
    
                    // Перебираем данные и создаём строки таблицы
                    data.forEach(function(car) {
                        let row = `
                            <tr>
                                <td>${car.make}</td>
                                <td>${car.model_name}</td>
                                <td>${car.year}</td>
                                <td>${car.mileage} км</td>
                                <td><a href="/cars/${car.slug}/">Подробнее</a></td>
                            </tr>
                        `;
                        $('#cars-table-body').append(row);
                    });
                });
            });
    
            // Обработчик для кнопки "Показать водителей"
            $('#show-drivers').click(function() {
                $.get('/get_drivers/', function(data) {
                    // Показываем таблицу водителей и скрываем остальные
                    $('#drivers-table').show();
                    $('#cars-table').hide();
                    $('#trips-table').hide();
    
                    // Очищаем содержимое tbody
                    $('#drivers-table-body').empty();
    
                    // Перебираем данные и создаём строки таблицы
                    data.forEach(function(driver) {
                        let row = `
                            <tr>
                                <td>${driver.surname}</td>
                                <td>${driver.name}</td>
                                <td>${driver.date_of_birth}</td>
                                <td><a href="/drivers/${driver.slug}/">Подробнее</a></td>
                            </tr>
                        `;
                        $('#drivers-table-body').append(row);
                    });
                });
            });
    
            // Обработчик для кнопки "Показать поездки"
            $('#show-trips').click(function() {
                $.get('/get_trips/', function(data) {
                    // Показываем таблицу поездок и скрываем остальные
                    $('#trips-table').show();
                    $('#cars-table').hide();
                    $('#drivers-table').hide();
    
                    // Очищаем содержимое tbody
                    $('#trips-table-body').empty();
    
                    // Перебираем данные и создаём строки таблицы
                    data.forEach(function(trip) {
                        let row = `
                            <tr>
                                <td>${trip.start_point}</td>
                                <td>${trip.end_point}</td>
                                <td>${trip.driver_id__surname} ${trip.driver_id__name}</td>
                                <td>${trip.car_id__make} ${trip.car_id__model_name}</td>
                                <td>${trip.start_time}</td>
                                <td>${trip.end_time}</td>
                                <td><a href="/trips/${trip.slug}/">Подробнее</a></td>
                            </tr>
                        `;
                        $('#trips-table-body').append(row);
                    });
                });
            });
        });
    </script>

<!-- Панель управления -->
<div class="container mt-5">
  <!-- Раздел "Автомобили" -->
  <div class="section">
      <h2>Автомобили</h2>
      <div class="row">
          <!-- Карточка для добавления автомобиля -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Добавить автомобиль</h5>
                      <form id="addCarForm">
                          <div class="form-group">
                              <label for="carBrand">Марка</label>
                              <input type="text" class="form-control" id="carBrand" required>
                          </div>
                          <div class="form-group">
                              <label for="carModel">Модель</label>
                              <input type="text" class="form-control" id="carModel" required>
                          </div>
                          <div class="form-group">
                              <label for="carYear">Год выпуска</label>
                              <input type="number" class="form-control" id="carYear" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Добавить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для удаления автомобиля -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Удалить автомобиль</h5>
                      <form id="deleteCarForm">
                          <div class="form-group">
                              <label for="carIdDelete">ID автомобиля</label>
                              <input type="number" class="form-control" id="carIdDelete" required>
                          </div>
                          <button type="submit" class="btn btn-danger">Удалить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для поиска автомобиля по Id -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Найти автомобиль по Id</h5>
                      <form id="findCarForm">
                          <div class="form-group">
                              <label for="carIdFind">ID автомобиля</label>
                              <input type="number" class="form-control" id="carIdFind" required>
                          </div>
                          <button type="submit" class="btn btn-warning">Найти</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Раздел "Водители" -->
  <div class="section">
      <h2>Водители</h2>
      <div class="row">
          <!-- Карточка для добавления водителя -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Добавить водителя</h5>
                      <form id="addDriverForm">
                          <div class="form-group">
                              <label for="driverName">Имя</label>
                              <input type="text" class="form-control" id="driverName" required>
                          </div>
                          <div class="form-group">
                              <label for="driverLicense">Номер водительского удостоверения</label>
                              <input type="text" class="form-control" id="driverLicense" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Добавить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для удаления водителя -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Удалить водителя</h5>
                      <form id="deleteDriverForm">
                          <div class="form-group">
                              <label for="driverIdDelete">ID водителя</label>
                              <input type="number" class="form-control" id="driverIdDelete" required>
                          </div>
                          <button type="submit" class="btn btn-danger">Удалить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для поиска водителя по Id -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Найти водителя по Id</h5>
                      <form id="findDriverForm">
                          <div class="form-group">
                              <label for="driverIdFind">ID водителя</label>
                              <input type="number" class="form-control" id="driverIdFind" required>
                          </div>
                          <button type="submit" class="btn btn-warning">Найти</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>

  <!-- Раздел "Поездки" -->
  <div class="section">
      <h2>Поездки</h2>
      <div class="row">
          <!-- Карточка для добавления поездки -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Добавить поездку</h5>
                      <form id="addTripForm">
                          <div class="form-group">
                              <label for="tripCarId">ID автомобиля</label>
                              <input type="number" class="form-control" id="tripCarId" required>
                          </div>
                          <div class="form-group">
                              <label for="tripDriverId">ID водителя</label>
                              <input type="number" class="form-control" id="tripDriverId" required>
                          </div>
                          <div class="form-group">
                              <label for="tripStart">Начало поездки</label>
                              <input type="datetime-local" class="form-control" id="tripStart" required>
                          </div>
                          <div class="form-group">
                              <label for="tripEnd">Конец поездки</label>
                              <input type="datetime-local" class="form-control" id="tripEnd" required>
                          </div>
                          <button type="submit" class="btn btn-primary">Добавить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для удаления поездки -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Удалить поездку</h5>
                      <form id="deleteTripForm">
                          <div class="form-group">
                              <label for="tripIdDelete">ID поездки</label>
                              <input type="number" class="form-control" id="tripIdDelete" required>
                          </div>
                          <button type="submit" class="btn btn-danger">Удалить</button>
                      </form>
                  </div>
              </div>
          </div>

          <!-- Карточка для поиска поездки по Id -->
          <div class="col-md-4">
              <div class="card">
                  <div class="card-body">
                      <h5 class="card-title">Найти поездку по Id</h5>
                      <form id="findTripForm">
                          <div class="form-group">
                              <label for="tripIdFind">ID поездки</label>
                              <input type="number" class="form-control" id="tripIdFind" required>
                          </div>
                          <button type="submit" class="btn btn-warning">Найти</button>
                      </form>
                  </div>
              </div>
          </div>
      </div>
  </div>
</div>
{% endblock %}

